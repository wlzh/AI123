

<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#f9f9f9" />

	<title>大模型AI生成式搜索的简约实战：从PerplexityAI到基于duckduckgo&#43;chatglm2-6b的搜索实现 作者： 老刘说NLP 来源： 老刘说NLP 今天是2024年1月16日，星期一，北京，天气晴，我们再来看看一些有趣的话题。 最近AI搜索受到大家关注，这种生成式AI搜索工具，使用OpenAI的GPT-4等基础语言模型和互联网上的最新信息，不仅能提供答  | AI123| ai工具网址导航,ai最新产品</title>
	<link rel="shortcut icon" href="/assets/images/favicon.png" />
    <meta name="keywords" content="chatgpt,AI,AI聊天,AI文本生成,AI绘画,AI编程,AI电商" />
    <meta name="description" content="AI123 网址导航 | 免费chatgpt 汇集各类先进的人工智能产品，旨在帮助用户更快速地了解和使用这些产品,轻松地浏览不同领域的AI产品，包括语音识别、图像处理、自然语言处理。" />
    
    <meta name="baidu-site-verification" content="codeva-cCAOSG8MBO" />
    
    <link rel="stylesheet" id="block-library-css"
        href="/assets/css/block-library.min-5.6.2.css" type="text/css" media="all" />
    <link rel="stylesheet" id="iconfont-css" href="/assets/css/iconfont-3.03029.1.css"
        type="text/css" media="all" />

    
    <link href="/scss/style.min.css" rel="stylesheet" />
    
		    <link rel="stylesheet" id="iowen-css" href="/assets/css/style-3.03029.1.css"
        type="text/css" media="all" />
    <link rel="stylesheet" id="custom-css" href="/assets/css/custom-style.css"
        type="text/css" media="all" />
		
		<link rel="stylesheet" href=/plugins/font-awesome/css/font-awesome.min.css />


    <link rel="stylesheet" id="fortawesome-css" href="/assets/fontawesome-5.15.4/css/all.min.css" type="text/css" />


    <script type="text/javascript" src="/assets/js/jquery.min-3.2.1.js" id="jquery-js"></script>
    <script type="text/javascript" src="/assets/js/content-search.js"  id="content-search-js"></script>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2073588164294660"
     crossorigin="anonymous"></script>

	
    <script>
        

		var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8450bc732b2a86f7e4aec4ebd9fd8252";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();

        
    </script>
    

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7071W80M2K"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-7071W80M2K');
    </script>

</head>


    <div class="page-container">
	
	<div id="sidebar" class="sticky sidebar-nav fade animate-nav" style="width: 170px">
        
            <div class="modal-dialog h-100 sidebar-nav-inner">
                <div class="sidebar-logo border-bottom border-color">
                    
                    <div class="logo overflow-hidden">
                        <a href="https://ai123.869hr.uk/" class="logo-expanded">
                            <img src="/assets/images/bt8-expand-light.png" height="40" class="logo-light"
                                alt="AI123| ai工具网址导航,ai最新产品">
                            <img src="/assets/images/bt8-expand-dark.png" height="40" class="logo-dark d-none"
                                alt="AI123| ai工具网址导航,ai最新产品">
                        </a>
                        <a href="https://ai123.869hr.uk/" class="logo-collapsed">
                            <img src="/assets/images/bt.png" height="40" class="logo-light"
                                alt="AI123| ai工具网址导航,ai最新产品">
                            <img src="/assets/images/bt.png" height="40" class="logo-dark d-none"
                                alt="AI123| ai工具网址导航,ai最新产品">
                        </a>
                    </div>
                    
                </div>
                <div class="sidebar-menu flex-fill">
                    <div class="sidebar-scroll">
                        <div class="sidebar-menu-inner">
                            <ul>
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#00834a9dd147b04c5d53d4368cdb0b57" class="smooth">
                                            <i class="fas fa-sun fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>本月热门</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#db0311e7ecfedd24d157f0ceb4a0897f" class="smooth">
                                            <i class="fas fa-star-and-crescent fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>热门网站</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#21b5cbb2c769010fec3ce029a5f8a4a3" class="smooth">
                                            <i class="far fa-star fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>国内热门</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#8310718935e8ec25ce0350de01e3f7dc" class="smooth">
                                            <i class="fas fa-phone fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>对话工具</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#d58e850d9115797306c2edf61ac6ddd8" class="smooth">
                                            <i class="fas fa-newspaper fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>写作</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#2a7418a5f8f1ca4e054364a9300657df" class="smooth">
                                            <i class="fas fa-image fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>图像生成</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#7808a68ee1b34dab43011429a12de19e" class="smooth">
                                            <i class="fas fa-image fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>图像处理</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#6729afc51f5ac49a828812fa0eb0c82f" class="smooth">
                                            <i class="fas fa-video fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>音视频</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#e5ce844860451fff3faf3d8f8894971d" class="smooth">
                                            <i class="fas fa-music fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>音乐生成</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#db53804b7d726967c58fcc8c9ca03d27" class="smooth">
                                            <i class="fas fa-language fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>办公</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#47b7af9547e034d28fe6f6d439968ac8" class="smooth">
                                            <i class="fas fa-copy fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>提示词</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#41282bf95e43c64d579757573a03cdde" class="smooth">
                                            <i class="fas fa-code fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>编程</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#fd71852fd52d5e18ef4f9a252f1eac58" class="smooth">
                                            <i class="fas fa-search fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>AI搜索</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#81b1637fbe47625dbdf2094acd3b6683" class="smooth">
                                            <i class="fas fa-language fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>文本翻译</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#2e9ba3fa6e1ed0e9311b3e97f97f9a40" class="smooth">
                                            <i class="fas fa-book fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>学习网站</span>
                                        </a>
                                    </li>
                                    
                                
                            </ul>           
                        </div>
                    </div>
                </div>
                <div class="border-top py-2 border-color">
                    <div class="flex-bottom">
                        <ul>
			    <li id="menu-item-212"
                                 class="menu-item menu-item-type-custom menu-item-object-custom menu-item-212 sidebar-item">
                                 <a href="#friendlink" class="smooth">
                                     <i class="fab fa-staylinked icon-fw icon-lg mr-2"></i>
                                     <span>友情链接</span>
                                 </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>


<div class="flex-fill grid-bg">
    <div class="big-header-banner">
        <div id="header" class="page-header sticky">
            <div class="navbar navbar-expand-md">
                <div class="container-fluid p-0">

                    <a href="" class="navbar-brand d-md-none" title="AI123| ai工具网址导航,ai最新产品">
                        <img src="/assets/images/bt.png" class="logo-light"
                            alt="AI123| ai工具网址导航,ai最新产品">
                        <img src="/assets/images/bt.png" class="logo-dark d-none"
                            alt="AI123| ai工具网址导航,ai最新产品">
                    </a>

                    <div class="collapse navbar-collapse order-2 order-md-1">
                        <div class="header-mini-btn">
                            <label>
                                <input id="mini-button" type="checkbox">
                                <svg viewbox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                                    <path class="line--1" d="M0 40h62c18 0 18-20-17 5L31 55"></path>
                                    <path class="line--2" d="M0 50h80"></path>
                                    <path class="line--3" d="M0 60h62c18 0 18 20-17-5L31 45"></path>
                                </svg>
                            </label>

                        </div>

                        <ul class="navbar-nav site-menu" style="margin-right: 16px;">
                        
			<li >
				<a href="/">
                                    <i class="fa fa-home fa-lg mr-2"></i>
                                    <span>首页</span>
                                </a>
				<ul class="sub-menu">
				
				</ul>
			    </li>
			
			</ul>

                        
                        <div class="rounded-circle weather">
                            <div id="he-plugin-simple" style="display: contents;"></div>
                            <script>WIDGET = {
                                    CONFIG: {
                                        "modules": "01234",
                                        "background": 5,
                                        "tmpColor": "008000",
                                        "tmpSize": 14,
                                        "cityColor": "008000",
                                        "citySize": 14,
                                        "aqiColor": "#008000",
                                        "aqiSize": 14,
                                        "weatherIconSize": 24,
                                        "alertIconSize": 18,
                                        "padding": "10px 10px 10px 10px",
                                        "shadow": "1",
                                        "language": "auto",
                                        "borderRadius": 5,
                                        "fixed": "false",
                                        "vertical": "middle",
                                        "horizontal": "left",
                                        "key": "085791e805a24491b43b06cf58ab31e7"
                                    }
                                }
                            </script>
                            <script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script>
                        </div>
                        
                    </div>

                    <ul class="nav navbar-menu text-xs order-1 order-md-2">
                        
                        
                        <li class="nav-item mr-3 mr-lg-0 d-none d-lg-block">
                            <script>
                                fetch('https://v1.hitokoto.cn')
                                    .then(response => response.json())
                                    .then(data => {
                                    const hitokoto = document.getElementById('hitokoto_text')
                                    hitokoto.href = 'https://hitokoto.cn/?uuid=' + data.uuid
                                    hitokoto.innerText = data.hitokoto
                                    })
                                    .catch(console.error)
                            </script>                           
                            <div id="hitokoto"><a href="#" target="_blank" id="hitokoto_text">疏影横斜水清浅，暗香浮动月黄昏。</a></div>
                        </li>
                        
                        
                        <li class="nav-search ml-3 ml-md-4">
                            <a href="javascript:" data-toggle="modal" data-target="#search-modal"><i
                                    class="iconfont icon-search icon-2x"></i></a>
                        </li>
                        <li class="nav-item d-md-none mobile-menu ml-3 ml-md-4">
                            <a href="javascript:" id="sidebar-switch" data-toggle="modal"
                                data-target="#sidebar"><i class="iconfont icon-classification icon-2x"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="placeholder" style="height:74px"></div>
    </div>




<body class="page-body boxed-container  io-grey-mode">
    <main role="main" class="flex-shrink-0">
    <div class="container">
        
        <div class="content">
            <style>
    body{
	    background: #f9f9f9;
	}

    h1, h2, h3, h4, h5, h6 {
        margin-top: 1.5rem;
        margin-bottom: 1.5rem;
    }


 
@media (min-width: 1000px) {
  .container, .container-sm {
    max-width: 800px;
  }
}

</style>

<div class="featured-post-content">

    <a href="/digest/" class="featured-post-title">
       AI 文摘
    </a>

</div>

<section class="blog-single">
  <div class="container">
    <div class="row">

      <div class="col-lg-12 order-1 order-lg-2">
        <article class="single-blog">
          <p class="title">大模型AI生成式搜索的简约实战：从PerplexityAI到基于duckduckgo&#43;chatglm2-6b的搜索实现</p>
            <br/>
          <ul class="meta">
            <li>
              By <a href=https://ai123.869hr.uk/about>AI123</a>
            </li>
            <li>
              <i class="fa fa-clock-o"></i>
              January 16, 2024 - 2 min read
            </li>
          </ul>

          <div class="_1NCGf">
              <img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/fUBU1yiaEmJgbDfrRWswcetlCvrHVxEJyc6yfgqJkGRWhX3F7BjnWVW0XtrffiarWicbeqp6zicepIyiaEO3BeEwJiaQ/640?wx_fmt=png&amp;from=appmsg" width="640" >
          </div>
            <br>
            <br>
            <br>
          
          <div class="single-blog-content">
            <p>作者： 老刘说NLP  来源： <a href="https://mp.weixin.qq.com/s/AEWDV_9eWO32qPgIrx_xLQ">老刘说NLP</a></p>
<p>今天是2024年1月16日，星期一，北京，天气晴，我们再来看看一些有趣的话题。</p>
<p>最近AI搜索受到大家关注，这种生成式AI搜索工具，使用OpenAI的GPT-4等基础语言模型和互联网上的最新信息，不仅能提供答案，还能提供答案来源的参考信息，解决用于训练模型的训练数据可能过时的局限性。通过返回用于提供答案的来源，以验证其准确性，最终解决语言模型生成错误答案的问题。</p>
<p>实际上，我们在之前的文章2023-04-05的**《如何解决类ChatGPT生成的时效性问题：基于duckduckgo_search+GLM-6B路线的一个简单实验分析》** (<a href="https://mp.weixin.qq.com/s/77lY9ITSaC_SwdwyLiN17A">https://mp.weixin.qq.com/s/77lY9ITSaC_SwdwyLiN17A</a>)就讲过类似的事情。</p>
<p>例如，引入实体链接，增强实时搜索相关性，提升query命中率，引入搜索结果，丰富上下文，以此作为输入，增强生成准确性。</p>
<p>而与此相关的另一个话题是这类技术如何进行评估，有个文章《Evaluating Verifiability in Generative Search Engines》(<a href="https://arxiv.org/pdf/2304.09848.pdf">https://arxiv.org/pdf/2304.09848.pdf</a>)从文本流畅度、感知有效性、引文回忆率和引文精确度四个角度对Bing Chat, NeevaAI, perplexity.ai和YouChat进行了评估。</p>
<p>本文主要介绍perplexity的简单实现以及基于duckduckgo+chatglm2-6b的搜索实现两个话题进行介绍，供大家一起参考。</p>
<p><strong>对了，我们在文章《<a href="http://mp.weixin.qq.com/s?__biz=MzAxMjc3MjkyMg==&amp;mid=2648407080&amp;idx=1&amp;sn=e85d2059452a2ac756df7c8205075abe&amp;chksm=83836f7db4f4e66bb823542e83ed031acb1326913e0e382abacd47c0f92d683f78f0b96b49a7&amp;scene=21#wechat_redirect">MOE、RAG、大模型、知识图谱的那些事儿回放:老刘说NLP2024第一个半月及2023年年终技术总结</a>》(<a href="http://mp.weixin.qq.com/s?__biz=MzAxMjc3MjkyMg==&amp;mid=2648407080&amp;idx=1&amp;sn=e85d2059452a2ac756df7c8205075abe&amp;chksm=83836f7db4f4e66bb823542e83ed031acb1326913e0e382abacd47c0f92d683f78f0b96b49a7&amp;scene=21#wechat_redirect">https://mp.weixin.qq.com/s/81YfjuvdYwfSQmU-zFlrRQ</a>)中已经开放了《老刘说NLP的2024第一讲：—MOE、RAG搜索增强及大模型进展那些事儿》、《老刘说NLP的2023年终总结：关于大模型和知识图谱的那些有趣的事儿》两个报告回放和ppt，感兴趣的可以<a href="https://mp.weixin.qq.com/s?__biz=MzAxMjc3MjkyMg==&amp;mid=2648402106&amp;idx=1&amp;sn=87e5a6ec56726630e5a76494d14a360c&amp;scene=21#wechat_redirect">加入社区</a>一起看看，干货满满。</strong> ‍‍‍‍‍‍‍‍‍‍‍‍</p>
<h4 id="一perplexity的简单实现">一、perplexity的简单实现</h4>
<p>PerplexityAI使用基础语言模型（如OpenAI的GPT-4）和互联网上的最新信息，它不仅能提供答案，还能提供这些答案的来源参考。</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/fUBU1yiaEmJgbDfrRWswcetlCvrHVxEJyMN68x4SBZjaEic7ev5AM2Qiagq8D3JgcqPGO8DQeFEGK1I7mmTyYPhCw/640?wx_fmt=png&amp;from=appmsg" alt="">image</p>
<p>其功能界面如图所示，正如文章(<a href="https://mp.weixin.qq.com/s/0zUQFixXQ9vwWTCIR_b1iA">https://mp.weixin.qq.com/s/0zUQFixXQ9vwWTCIR_b1iA</a>)所提到的，<strong>与传统搜索引擎相比，回答引擎主要在以下几个方面进行了优化：理解用户问题的能力、总结搜索结果的能力、保留搜索结果索引的能力，以及扩展用户问题的能力。这些优化旨在降低用户使用门槛，节省用户在不同网页上搜索和浏览的时间，确保搜索结果的可靠性，同时为用户提供深入挖掘问题的能力。</strong></p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/fUBU1yiaEmJgbDfrRWswcetlCvrHVxEJyc6yfgqJkGRWhX3F7BjnWVW0XtrffiarWicbeqp6zicepIyiaEO3BeEwJiaQ/640?wx_fmt=png&amp;from=appmsg" alt="">image</p>
<p>其本质上就是做了一次搜索增强问答，开源项目<strong>地址：https://github.com/mklarqvist/ai-playground/blob/main/perplexity-clone/perplexity_clone.ipynb</strong> 给出了一个简单实现。</p>
<p>这就解决了语言模型生成错误答案的问题，工作流程如下：</p>
<p><strong>1、用户提出问题</strong></p>
<pre><code>query = 'history of the human genome project' # The query to search Google for and ask the AI about  
</code></pre>
<p><strong>2、使用该问题进行谷歌搜索</strong></p>
<pre><code>response = requests.get(f&quot;https://www.google.com/search?q={query}&quot;) # Make the request  
</code></pre>
<p><strong>3、下载前k个搜索结果或最相关的网页</strong></p>
<pre><code>soup = BeautifulSoup(response.text, &quot;html.parser&quot;) # Parse the HTML  
links = soup.find_all(&quot;a&quot;) # Find all the links in the HTML  
# loop over `links` and keep only the one that have the href starting with &quot;/url?q=&quot;  
urls = []  
for l in [link for link in links if link[&quot;href&quot;].startswith(&quot;/url?q=&quot;)]:  
    # get the url  
    url = l[&quot;href&quot;]  
    # remove the &quot;/url?q=&quot; part  
    url = url.replace(&quot;/url?q=&quot;, &quot;&quot;)  
    # remove the part after the &quot;&amp;sa=...&quot;  
    url = unquote(url.split(&quot;&amp;sa=&quot;)[0])  
    # special case for google scholar  
    if url.startswith(&quot;https://scholar.google.com/scholar_url?url=http&quot;):  
        url = url.replace(&quot;https://scholar.google.com/scholar_url?url=&quot;, &quot;&quot;).split(&quot;&amp;&quot;)[0]  
    elif 'google.com/' in url: # skip google links  
        continue  
    if url.endswith('.pdf'): # skip pdf links  
        continue  
    if '#' in url: # remove anchors (e.g. wikipedia.com/bob#history and wikipedia.com/bob#genetics are the same page)  
        url = url.split('#')[0]  
    # print the url  
    urls.append(url)
</code></pre>
<p>####<strong>4、通过LangChain将原始HTML数据转换为可用格式</strong></p>
<pre><code>from readabilipy import simple_json_from_html_string # Required to parse HTML to pure text  
from langchain.schema import Document # Required to create a Document object  
def scrape_and_parse(url: str) -&gt; Document:  
    &quot;&quot;&quot;Scrape a webpage and parse it into a Document object&quot;&quot;&quot;  
    req = requests.get(url)  
    article = simple_json_from_html_string(req.text, use_readability=True)  
    # The following line seems to work with the package versions on my local machine, but not on Google Colab  
    # return Document(page_content=article['plain_text'][0]['text'], metadata={'source': url, 'page_title': article['title']})  
    return Document(page_content='\n\n'.join([a['text'] for a in article['plain_text']]), metadata={'source': url, 'page_title': article['title']})  
# It's possible to optitimize this by using asyncio, but it's not necessary for this example  
documents = [scrape_and_parse(f) for f in urls] # Scrape and parse all the urls  
</code></pre>
<p><strong>5、将所有文档分割成1000个字符的chunk块</strong></p>
<pre><code>from langchain.text_splitter import CharacterTextSplitter  
text_splitter = CharacterTextSplitter(separator=' ', chunk_size=1000, chunk_overlap=200)  
texts = text_splitter.split_documents(documents)  
</code></pre>
<p><strong>6、计算每个文档块的嵌入，并将其存储在向量存储区（chromadb）中</strong></p>
<pre><code>from langchain.embeddings.openai import OpenAIEmbeddings  
# Get your own APU key at https://platform.openai.com/account/api-keys  
OPENAI_API_KEY = 'REPLACE_WITH_YOUR_KEY' # Replace with your own OpenAI API key  
embeddings = OpenAIEmbeddings(openai_api_key=OPENAI_API_KEY)  
from langchain.vectorstores import Chroma  
docsearch = Chroma.from_documents(texts, embeddings)  
</code></pre>
<p><strong>7、使用步骤1中的用户问题和所有通过LangChain获取的网络数据创建提示</strong></p>
<pre><code>query = &quot;Who were the main players in the race to complete the human genome? And what were their approaches? Give as much detail as possible.&quot;  
</code></pre>
<p><strong>8、查询OpenAI模型以生成答案</strong></p>
<pre><code>from langchain.llms import OpenAIChat # Required to create a Language Model  
# Pick an OpenAI model  
llm = OpenAIChat(model_name='gpt-3.5-turbo', openai_api_key=OPENAI_API_KEY)  
from langchain import  VectorDBQA # Required to create a Question-Answer object using a vector  
import pprint # Required to pretty print the results  
# Stuff all the information into a single prompt (see https://docs.langchain.com/docs/components/chains/index_related_chains#stuffing)  
qa = VectorDBQA.from_chain_type(llm=llm, chain_type=&quot;stuff&quot;, vectorstore=docsearch, return_source_documents=True)  
query = &quot;Who were the main players in the race to complete the human genome? And what were their approaches? Give as much detail as possible.&quot;  
result = qa({&quot;query&quot;: query})  
pprint.pprint(result)  
</code></pre>
<p><strong>9、识别有助于生成答案的文档，并将其作为参考材料返回</strong></p>
<pre><code>{'query': &quot;What happened to Craig Venter's company following the completion of &quot;  
          'the human genome project? Give as much detail as possible.',  
 'result': 'Following the completion of the human genome project, Craig '  
           &quot;Venter's company, Celera Genomics, faced a decision on what type &quot;  
           'of company it would become. It added sequences from three '  
           'different mouse strains to its database and briefly ventured into '  
           'proteomics. However, Venter resigned as CEO in January 2002, and '  
           'the company decided to focus on drug discovery rather than '  
           'information. Despite being timed to coincide with the celebrations '  
           'of the 50th anniversary of the Watson-Crick discovery of the '  
           'double-helical structure of DNA, there was less fanfare '  
           'surrounding the official date of completion of the HGP in April '  
           '2003. Celera remained a threat, as the validity of the WGS '  
           'sequencing approach was demonstrated in March 2000 when Celera and '  
           'the Berkeley Drosophila Genome Project published the sequence of '  
           'D. melanogaster. However, the rivalry between Celera and the HGP '  
           'ended when they joined forces, thus speeding up the completion of '  
           'the rough draft sequence of the human genome.',  
 'source_documents': [Document(page_content='NIH scientist J. Craig Venter, began to compete with and potentially undermine the publicly funded HGP. At the heart of the competition was the prospect of gaining control over potential patents on the genome sequence, which was considered a pharmaceutical treasure trove. Although the legal and financial reasons remain unclear, the rivalry between Celera and the NIH ended when they joined forces, thus speeding completion of the rough draft sequence of the human genome. The completion of the rough draft was announced in June 2000 by Collins and Venter. For the next three years, the rough draft sequence was refined, extended, and further analyzed, and in April 2003, coinciding with the 50th anniversary of the publication that described the double-helical structure of DNA, written by British biophysicist Francis Crick and American geneticist and biophysicist James D. Watson, the HGP was declared complete. Britannica Quiz Genetics Quiz Science behind the HGP To appreciate the magnitude,', metadata={'source': 'https://www.britannica.com/event/Human-Genome-Project', 'page_title': 'Human Genome Project (HGP) | History, Timeline, &amp; Facts'})  
</code></pre>
<h4 id="二基于duckduckgochatglm2-6b的搜索实现">二、基于duckduckgo+chatglm2-6b的搜索实现</h4>
<p>实时性，一直是大家对chatgpt这类应用发问较多的问题，而通过借助搜索引擎的结果，我们可以在此基础上，通过搜索的结果进行简单拼接、摘要、截断等方式，快速获得一个较好的结果。</p>
<p><strong>1、实现思想</strong></p>
<p>我们可以基于glm6b来搭建一个服务，直接将该服务的接口作为chatgpt生成答案的平替。ChatGLM-6B 是一个开源的、支持中英双语的对话语言模型，基于 General Language Model (GLM) 架构，具有 62 亿参数。</p>
<p>结合模型量化技术，用户可以在消费级的显卡上进行本地部署（INT4 量化级别下最低只需 6GB 显存）。 ChatGLM-6B 使用了和 ChatGPT 相似的技术，针对中文问答和对话进行了优化。</p>
<p>地址：https://github.com/THUDM/ChatGLM-6B</p>
<p>思路很简单：首先，我们给定一个query，调用duckduckgo_search，得到实时结果后，调用glm6b的生成服务，得到最终答案。</p>
<p>整个实现思路，很朴素，但核心就两个半，一个是底层大模型，另一个是实时搜索。还有半个，是对应的prompt。</p>
<p><strong>2、chatglm-6b搭建服务</strong></p>
<pre><code>#!/usr/bin/env python  
# -*- coding: UTF-8 -*-  
import os  
import json  
from flask import Flask, request  
from transformers import AutoModel, AutoTokenizer  
  
os.environ[&quot;CUDA_VISIBLE_DEVICES&quot;] = &quot;3&quot;  
tokenizer = AutoTokenizer.from_pretrained(r&quot;chatglm-6b&quot;, trust_remote_code=True,  
                                          revision=&quot;main&quot;)  
model = AutoModel.from_pretrained(r&quot;chatglm-6b&quot;, trust_remote_code=True,  
                                  revision=&quot;main&quot;).half().quantize(4).cuda()  
model = model.cuda()  
model = model.eval()  
app = Flask(import_name=__name__)  
  
def predict(input_string, history):  
    if history is None:  
        history = []  
    try:  
        response, history = model.chat(tokenizer, input_string, history)  
        return {&quot;msg&quot;: &quot;success&quot;, &quot;code&quot;: 200, &quot;response&quot;: response}  
    except Exception as error:  
        return {&quot;msg&quot;: &quot;error&quot;, &quot;code&quot;: 500, &quot;response&quot;: error}  
  
@app.route(&quot;/chat_with_history&quot;, methods=[&quot;POST&quot;, &quot;GET&quot;])  
def chat_with_history():  
    data = json.loads(request.data)  
    input_text = data['input_text']  
    history = data.get(&quot;history&quot;, None)  
    if history is not None:  
        history = json.loads(history)  
    return predict(input_text, history)  
  
if __name__ == '__main__':  
    app.run(port=12345, debug=True, host='0.0.0.0')  # 如果是0.0.0.0，则可以被外网访问  
</code></pre>
<p><strong>3、使用duckduckgo_search输出结果，完成实时搜索</strong></p>
<pre><code>我们以实时的百度热搜，进行时效性检测，下面是具体热搜榜单：  
  
图片  
下面是具体的结果，效果看起来还不错，本质上是一个MRC任务：  
</code></pre>
<hr>
<pre><code>enter an query to search:马克龙在什么时候来北京了最近  
query: 马克龙在什么时候来北京了最近  
answer: 马克龙于 2023 年 4 月 5 日至 7 日对中国进行国事访问。  
</code></pre>
<hr>
<pre><code>enter an query to search:谁最近停售了张继科肖像产品  
query: 谁最近停售了张继科肖像产品  
answer: 蝴蝶乒乓球用品公司最近停售了张继科肖像产品。  
</code></pre>
<hr>
<pre><code>enter an query to search:特朗普认罪了么，最高会判几年  
query: 特朗普认罪了么，最高会判几年  
answer: 特朗普没有认罪，并且这些指控可能会导致他被判处136年的监禁。  
</code></pre>
<hr>
<pre><code>enter an query to search:张继科最近犯了啥事  
query: 张继科最近犯了啥事  
answer: 张继科最近犯了一些法律事件，其中包括恋爱期间劈腿、涉赌、泄露他人隐私视频以及欠下巨额债务，其中债主拿着他的前女友的私密视频去抵债，景甜对此表示愤怒并告了这位债主，这位债主目前还在服刑中。  
</code></pre>
<hr>
<pre><code>enter an query to search:北京最新天气  
query: 北京最新天气  
answer: 根据最新的天气预报，北京最新天气为多云转晴，最高气温为12°C，最低气温为3°C，风力较小，只有2、3级。  
</code></pre>
<hr>
<pre><code>enter an query to search:今天几号  
query: 今天几号  
answer: 今天是 2023 年 4 月 4 日，是农历闰二月十四，同时也是阳历的星期四。  
</code></pre>
<hr>
<pre><code>enter an query to search:当前黄金价格多少  
query: 当前黄金价格多少  
answer: 根据提供的信息，今天是2023年4月4日，中国上海黄金交易所的黄金价格是439.6元人民币/克。这是裸黄金价格，商场的黄金首饰价格会在此基础上加上加工费等。按当前的汇率计算，1盎司黄金的价格约为1990.3美元。因此，当前黄金价格是439.6元人民币/克，1盎司黄金的价格约为1990.3美元。  
</code></pre>
<hr>
<pre><code>enter an query to search:马克龙访华，有哪三点值得关注  
query: 马克龙访华，有哪三点值得关注  
answer: 马克龙访华，值得关注的三点包括：  
1. 中法合作新成果：这是马克龙首次访华，也是中法两国元首继去年G20巴厘岛峰会后再一次面对面对话。双方将继续就共同关心的国际和地区问题进行沟通和协商，推动中法合作不断迈上新台阶。  
2. 经贸务实合作：马克龙此次访华将重点探讨双方合作的未来规划和经贸务实合作，包括贸易、投资、知识产权保护等领域。双方还将继续深化中法物流合作，促进数字经济等领域合作。  
3. 应对全球挑战：马克龙此前表示，应对全球挑战是中法两国共同使命。他此次访华将重点探讨应对气候变化、难民问题、恐怖主义等全球挑战，以及如何在多边框架内应对全球性问题。双方还将继续就非洲发展、国际合作等问题进行沟通和协商。  
</code></pre>
<h4 id="总结">总结</h4>
<p>本文主要介绍了perplexity的简单实现、基于duckduckgo+chatglm2-6b的搜索实现，感兴趣的可以进一步看看其中的链接深入扩展阅读。</p>
<p>我们在文章《MOE、RAG、大模型、知识图谱的那些事儿回放:老刘说NLP2024第一个半月及2023年年终技术总结》(<a href="https://mp.weixin.qq.com/s/81YfjuvdYwfSQmU-zFlrRQ">https://mp.weixin.qq.com/s/81YfjuvdYwfSQmU-zFlrRQ</a>)中已经开放了《老刘说NLP的2024第一讲：—MOE、RAG搜索增强及大模型进展那些事儿》、《老刘说NLP的2023年终总结：关于大模型和知识图谱的那些有趣的事儿》两个报告回放和ppt，感兴趣的可以加入社区一起看看，干货满满。</p>
<h4 id="参考文献">参考文献</h4>
<p>1、https://github.com/mklarqvist/ai-playground/blob/main/perplexity-clone/perplexity_clone.ipynb</p>
<p>2、https://mp.weixin.qq.com/s/77lY9ITSaC_SwdwyLiN17A</p>
<p>3、https://arxiv.org/pdf/2304.09848.pdf</p>
<h4 id="关于我们">关于我们</h4>
<p>老刘，刘焕勇，NLP开源爱好者与践行者，主页：https://liuhuanyong.github.io。</p>
<p>老刘说NLP，将定期发布语言资源、工程实践、技术总结等内容，欢迎关注。</p>
<p><strong>对于想加入更优质的知识图谱、事件图谱、大模型AIGC实践、相关分享的，可关注公众号，在后台菜单栏中点击会员社区-&gt;<a href="https://mp.weixin.qq.com/s?__biz=MzAxMjc3MjkyMg==&amp;mid=2648402106&amp;idx=1&amp;sn=87e5a6ec56726630e5a76494d14a360c&amp;scene=21#wechat_redirect">会员入群加入</a>。</strong></p>
<p>更多AI工具，参考<a href="https://ai123.869hr.uk/">Github-AI123</a>，<a href="https://ai123.869hr.uk/">国内AI123</a></p>



          </div>

 可扫如下微信二维码加好友

<p><img src="/images/aitools/2024/03/qrcode_for_gh_dde1b429630d_258.jpg" alt=""></p>

        </article>

      </div>
    </div>
  </div>
</section>
        </div>
    </div>
    </main>




<script type='text/javascript' src='/assets/js/jquery.ui.touch-punch.min-0.2.2.js' id='jqueryui-touch-js'></script>
<script type='text/javascript' src='/assets/js/clipboard.min-5.6.2.js' id='clipboard-js'></script>
<script type='text/javascript' src='/assets/js/tooltip-extend.js' id='iplaycode-nav-js'></script>
<script type='text/javascript' id='popper-js-extra'>
 

var theme = {"ajaxurl":"","addico":"https:\/\/nav.baidu.cn\/wp-content\/themes\/onenav\/images\/add.png","order":"asc","formpostion":"top","defaultclass":"io-grey-mode","isCustomize":"1","icourl":"","icopng":".png","urlformat":"1","customizemax":"10","newWindow":"0","lazyload":"1","minNav":"1","loading":"1","hotWords":"baidu","classColumns":" col-sm-6 col-md-4 col-xl-5a col-xxl-6a ","apikey":"TWpBeU1UVTNOekk1TWpVMEIvZ1M2bFVIQllUMmxsV1dZelkxQTVPVzB3UW04eldGQmxhM3BNWW14bVNtWk4="};
 
</script>
<script type='text/javascript' src='/assets/js/popper.min.js' id='popper-js'></script>
<script type='text/javascript' src='/assets/js/bootstrap.min-4.3.1.js' id='bootstrap-js'></script>
<script type='text/javascript' src='/assets/js/theia-sticky-sidebar-1.5.0.js' id='sidebar-js'></script>
<script type='text/javascript' src='/assets/js/lazyload.min-12.4.0.js' id='lazyload-js'></script>
<script type='text/javascript' src='/assets/js/fancybox.min-3.5.7.js' id='lightbox-js-js'></script>

<script type='text/javascript' src='/assets/js/app-anim.js' id='appanim-js'></script>

<script type="text/javascript">
    $(document).ready(function(){
        var siteWelcome = $('#loading');
        siteWelcome.addClass('close');
        setTimeout(function() {
            siteWelcome.remove();
        }, 600);
    });
</script>
<script>        
    $(document).ready(function(){
        setTimeout(function () {
            if ($('a.smooth[href="' + window.location.hash + '"]')[0]) {
                $('a.smooth[href="' + window.location.hash + '"]').click();
            }else if (window.location.hash != '') {
                $("html, body").animate({
                    scrollTop: $(window.location.hash).offset().top - 90
                }, {
                    duration: 500,
                    easing: "swing"
                });
            }
        }, 300);
        $(document).on('click','a.smooth',function(ev) {
            if($('#sidebar').hasClass('show') && !$(this).hasClass('change-href')){
                $('#sidebar').modal('toggle');
            }
            if($(this).attr("href").substr(0, 1) == "#"){
                $("html, body").animate({
                    scrollTop: $($(this).attr("href")).offset().top - 90
                }, {
                    duration: 500,
                    easing: "swing"
                });
            }
            if($(this).hasClass('go-search-btn')){
                $('#search-text').focus();
            }
            if(!$(this).hasClass('change-href')){
                var menu =  $("a"+$(this).attr("href"));
                menu.click();
                toTarget(menu.parent().parent(),true,true);
            }
        });
        $(document).on('click','a.tab-noajax',function(ev) {
            var url = $(this).data('link');
            if(url)
                $(this).parents('.d-flex.flex-fill.flex-tab').children('.btn-move.tab-move').show().attr('href', url);
            else
                $(this).parents('.d-flex.flex-fill.flex-tab').children('.btn-move.tab-move').hide();
        });
        
    });
</script>

<script>

(function(){
    if(document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") === ''){
        if(new Date().getHours() > 22 || new Date().getHours() < 6){
            document.body.classList.remove('io-black-mode');
            document.body.classList.add('io-grey-mode');
            document.cookie = "night=1;path=/";
            console.log('夜间模式开启');
        }else{
            document.body.classList.remove('night');
            document.cookie = "night=0;path=/";
            console.log('夜间模式关闭');
        }
    }else{
        var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
        if(night == '0'){
            document.body.classList.remove('night');
        }else if(night == '1'){
            document.body.classList.add('night');
        }
    }
})();

$("#search-bg").css("background", "linear-gradient(#e2c4c4, #d8d8d8)");   
function switchNightMode(){
    var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
    if(night == '0'){
	$("#search-bg").css("background", "linear-gradient(#e2c4c4, #d8d8d8)");
        document.body.classList.remove('io-grey-mode');
        document.body.classList.add('io-black-mode');
        document.cookie = "night=1;path=/"
        console.log(' ');
        $(".switch-dark-mode").attr("data-original-title","日间模式");
        $(".mode-ico").removeClass("icon-night");
        $(".mode-ico").addClass("icon-light");
    }else{
	$("#search-bg").css("background", "linear-gradient(#4f4040, #1b1d1f)");
        document.body.classList.remove('io-black-mode');
        document.body.classList.add('io-grey-mode');
        document.cookie = "night=0;path=/"
        console.log(' ');
        $(".switch-dark-mode").attr("data-original-title","夜间模式");
        $(".mode-ico").removeClass("icon-light");
        $(".mode-ico").addClass("icon-night");
    }
}
</script>


<script>
    var newsContainer = document.getElementById('news-container');
    var newsItems = document.getElementsByClassName('news-item');
    var currentItem = 0;

    setInterval(function() {
        
        newsItems[currentItem].classList.remove('show');
        newsItems[currentItem].style.transform = 'translateY(-20px)';
        
        currentItem = (currentItem + 1) % newsItems.length;
        newsItems[currentItem].style.transform = 'translateY(' + (newsContainer.offsetHeight - 20) + 'px)';
        setTimeout(function() {
            newsItems[currentItem].classList.add('show');
        }, 500);
    }, 8000);
</script>

</body>
</html>


